function laravel_patch_auth --description "ğŸ”‘ patches vendor auth for easy local login"
    set -l target_file ./vendor/laravel/ui/auth-backend/AuthenticatesUsers.php

    if not test -f $target_file
        echo (set_color red)"ERR: target file not found at '$target_file'."(set_color normal)
        return 1
    end

    echo "patching AuthenticatesUsers trait in $target_file..."

    # base64 encoded to prevent shell quoting issues
    set -l b64_content 'PD9waHAgZGVjbGFyZShzdHJpY3RfdHlwZXM9MSk7CgpuYW1lc3BhY2UgSWxsdW1pbmF0ZVxGb3VuZGF0aW9uXEF1dGg7Cgp1c2UgREI7CnVzZSBJbGx1bWluYXRlXEh0dHBcSnNvblJlc3BvbnNlOwp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgSWxsdW1pbmF0ZVxWYWxpZGF0aW9uXFZhbGlkYXRpb25FeGNlcHRpb247Cgp0cmFpdCBBdXRoZW50aWNhdGVzVXNlcnMKewogICAgdXNlIFJlZGlyZWN0c1VzZXJzOwogICAgdXNlIFRocm90dGxlc0xvZ2luczsKCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvd0xvZ2luRm9ybSgpCiAgICB7CiAgICAgICAgJGFsbG93ZWRSZWRpcmVjdHMgPSBbJy9hZG1pbicsICcvdXNlcicsICcvYWRtaW4vc3lzdGVtL2Nyb24nLCAnL2FkbWluL3N5c3RlbS90b29scyddOwoKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2NyZWF0ZV9uZXdfdXNlcicpICYmICFBdXRoOjpjaGVjaygpICYmIGFwcCgpLT5pc0xvY2FsKCkpIHsKICAgICAgICAgICAgJGZha2VyID0gXEZha2VyXEZhY3Rvcnk6OmNyZWF0ZSgpOwogICAgICAgICAgICAkcmVmZXJyYWxDb2RlID0gREI6OnRhYmxlKCdyZWZlcnJhbF9jb2RlX29wdGlvbnMnKS0+d2hlcmVOdWxsKCd1c2VkX2J5X3VpZCcpLT5pblJhbmRvbU9yZGVyKCktPnZhbHVlKCdyZWZlcnJhbF9jb2RlJykgPzogc3RydG91cHBlcigkZmFrZXItPndvcmQoKSk7CgogICAgICAgICAgICAkbmV3VXNlciA9IFxBcHBcTW9kZWxzXFVzZXI6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAnZmlyc3RfbmFtZScgPT4gJGZha2VyLT5maXJzdE5hbWUoKSwKICAgICAgICAgICAgICAgICdsYXN0X25hbWUnID0+ICRmYWtlci0+bGFzdE5hbWUoKSwKICAgICAgICAgICAgICAgICdlbWFpbCcgPT4gJGZha2VyLT51bmlxdWUoKS0+c2FmZUVtYWlsKCksCiAgICAgICAgICAgICAgICAncGFzc3dvcmQnID0+IGJjcnlwdCgncGFzc3dvcmQnKSwKICAgICAgICAgICAgICAgICdyZWZlcnJhbF9jb2RlJyA9PiAkcmVmZXJyYWxDb2RlLAogICAgICAgICAgICAgICAgJ2VtYWlsX3ZlcmlmaWVkX2F0JyA9PiBub3coKSwKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBBdXRoOjpsb2dpbigkbmV3VXNlcik7CgogICAgICAgICAgICAkcmVkaXJlY3QgPSByZXF1ZXN0KCktPmdldCgncmVkaXJlY3QnKTsKCiAgICAgICAgICAgIHJldHVybiAkcmVkaXJlY3QgJiYgaW5fYXJyYXkoJHJlZGlyZWN0LCAkYWxsb3dlZFJlZGlyZWN0cykKICAgICAgICAgICAgICAgID8gcmVkaXJlY3QoJHJlZGlyZWN0KQogICAgICAgICAgICAgICAgOiByZWRpcmVjdCgpLT5pbnRlbmRlZCgkdGhpcy0+cmVkaXJlY3RQYXRoKCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdjcmVhdGVfc2ltcGxlX3VzZXInKSAmJiAhQXV0aDo6Y2hlY2soKSAmJiBhcHAoKS0+aXNMb2NhbCgpKSB7CiAgICAgICAgICAgICR0aW1lc3RhbXAgPSBub3coKS0+Zm9ybWF0KCdZbWRIaXMnKTsKICAgICAgICAgICAgJHJlZmVycmFsQ29kZSA9IERCOjp0YWJsZSgncmVmZXJyYWxfY29kZV9vcHRpb25zJyktPndoZXJlTnVsbCgndXNlZF9ieV91aWQnKS0+aW5SYW5kb21PcmRlcigpLT52YWx1ZSgncmVmZXJyYWxfY29kZScpID86ICJVU0VSJHRpbWVzdGFtcCI7CgogICAgICAgICAgICAkbmV3VXNlciA9IFxBcHBcTW9kZWxzXFVzZXI6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAvLyAnZmlyc3RfbmFtZScgPT4gJ1Rlc3QnLAogICAgICAgICAgICAgICAgJ2ZpcnN0X25hbWUnID0+IFxGYWtlclxGYWN0b3J5OjpjcmVhdGUoKS0+Zmlyc3ROYW1lKCksCiAgICAgICAgICAgICAgICAvLyAnbGFzdF9uYW1lJyA9PiAnVXNlcicsCiAgICAgICAgICAgICAgICAnbGFzdF9uYW1lJyA9PiBcRmFrZXJcRmFjdG9yeTo6Y3JlYXRlKCktPmxhc3ROYW1lKCksCiAgICAgICAgICAgICAgICAvLyAnZW1haWwnID0+ICd0ZXN0JyAuICR0aW1lc3RhbXAgLiAnQGV4YW1wbGUuY29tJywKICAgICAgICAgICAgICAgICdlbWFpbCcgPT4gXEZha2VyXEZhY3Rvcnk6OmNyZWF0ZSgpLT51bmlxdWUoKS0+c2FmZUVtYWlsKCksCiAgICAgICAgICAgICAgICAncGFzc3dvcmQnID0+IGJjcnlwdCgncGFzc3dvcmQnKSwKICAgICAgICAgICAgICAgICdyZWZlcnJhbF9jb2RlJyA9PiAkcmVmZXJyYWxDb2RlLAogICAgICAgICAgICAgICAgJ2VtYWlsX3ZlcmlmaWVkX2F0JyA9PiBub3coKSwKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBBdXRoOjpsb2dpbigkbmV3VXNlcik7CgogICAgICAgICAgICAkcmVkaXJlY3QgPSByZXF1ZXN0KCktPmdldCgncmVkaXJlY3QnKTsKCiAgICAgICAgICAgIHJldHVybiAkcmVkaXJlY3QgJiYgaW5fYXJyYXkoJHJlZGlyZWN0LCAkYWxsb3dlZFJlZGlyZWN0cykKICAgICAgICAgICAgICAgID8gcmVkaXJlY3QoJHJlZGlyZWN0KQogICAgICAgICAgICAgICAgOiByZWRpcmVjdCgpLT5pbnRlbmRlZCgkdGhpcy0+cmVkaXJlY3RQYXRoKCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdfJykgJiYgIUF1dGg6OmNoZWNrKCkpIHsKICAgICAgICAgICAgJHVzZXJJZCA9IChpbnQpIHJlcXVlc3QoKS0+Z2V0KCdfJywgMSk7CgogICAgICAgICAgICBpZiAoJHVzZXJJZCA+IDApIHsKICAgICAgICAgICAgICAgIEF1dGg6OmxvZ2luVXNpbmdJZCgkdXNlcklkKTsKCiAgICAgICAgICAgICAgICAkcmVkaXJlY3QgPSByZXF1ZXN0KCktPmdldCgncmVkaXJlY3QnKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gJHJlZGlyZWN0ICYmIGluX2FycmF5KCRyZWRpcmVjdCwgJGFsbG93ZWRSZWRpcmVjdHMpCiAgICAgICAgICAgICAgICAgICAgPyByZWRpcmVjdCgkcmVkaXJlY3QpCiAgICAgICAgICAgICAgICAgICAgOiByZWRpcmVjdCgpLT5pbnRlbmRlZCgkdGhpcy0+cmVkaXJlY3RQYXRoKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIUF1dGg6OmNoZWNrKCkgJiYgYXBwKCktPmlzTG9jYWwoKSAmJiBpbl9hcnJheShyZXF1ZXN0KCktPmlwKCksIFsnMTI3LjAuMC4xJywgJzo6MSddKSkgewogICAgICAgICAgICAkcm91dGVzID0gWwogICAgICAgICAgICAgICAgWydhZG1pbiDhlZUoIOGQmyAp4ZWXJywgJy9hZG1pbiddLAogICAgICAgICAgICAgICAgWydjbGllbnQgYXJlYScsICcvdXNlciddLAogICAgICAgICAgICAgICAgWydjcm9uJywgJy9hZG1pbi9zeXN0ZW0vY3JvbiddLAogICAgICAgICAgICAgICAgWyd0b29scycsICcvYWRtaW4vc3lzdGVtL3Rvb2xzJ10sCiAgICAgICAgICAgIF07CgogICAgICAgICAgICBlY2hvICcKICAgICAgICAgICAgPGRpdiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyB6LWluZGV4OiA5OTk5OyB3aWR0aDogMTAwJTsiPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsgZ2FwOiAxMHB4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgZmxleC13cmFwOiB3cmFwOyBhbGlnbi1pdGVtczogY2VudGVyOyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYnRuLWdyb3VwIGJ0bi1ncm91cC1zbSIgcm9sZT0iZ3JvdXAiPgogICAgICAgICAgICAnOwoKICAgICAgICAgICAgZm9yZWFjaCAoJHJvdXRlcyBhcyBbJGxhYmVsLCAkcm91dGVdKSB7CiAgICAgICAgICAgICAgICAkdXJsID0gcm91dGUoJ2xvZ2luJywgWydfJyA9PiAxLCAncmVkaXJlY3QnID0+ICRyb3V0ZV0pOwogICAgICAgICAgICAgICAgZWNobyAiPGEgaHJlZj1cIiR1cmxcIiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1kYXJrXCI+JGxhYmVsPC9hPiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWNobyAnCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXgtMyI+CiAgICAgICAgICAgICAgICAgICAgPGltYWdlIHNyYz0iaHR0cHM6Ly90ZXJ1emEuY29tL2NvcmUvaW1nL2xvZ28uc3ZnIiBhbHQ9IlRlcnV6YSBMb2dvIiBzdHlsZT0iaGVpZ2h0OiAxNXB4OyB3aWR0aDogYXV0bzsiPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJ0bi1ncm91cCBidG4tZ3JvdXAtc20iIHJvbGU9Imdyb3VwIj4KICAgICAgICAgICAgJzsKICAgICAgICAgICAgZWNobyAnPGEgaHJlZj0iJyAuIHJvdXRlKCdsb2dpbicsIFsnY3JlYXRlX25ld191c2VyJyA9PiAxLCAncmVkaXJlY3QnID0+ICcvJ10pIC4gJyIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1wcmltYXJ5Ij5OZXcgRmFrZSBVc2VyIHvil5Ug4pehIOKXlX08L2E+JzsKICAgICAgICAgICAgZWNobyAnPGEgaHJlZj0iJyAuIHJvdXRlKCdsb2dpbicsIFsnY3JlYXRlX3NpbXBsZV91c2VyJyA9PiAxLCAncmVkaXJlY3QnID0+ICcvJ10pIC4gJyIgY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiPk5ldyBTaW1wbGUgVXNlciAo44O74oiA44O7ICk8L2E+JzsKICAgICAgICAgICAgZWNobyAnCiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2Pic7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmlldygnYXV0aC5sb2dpbicpOwogICAgfQoKICAgIC8qKgogICAgICogSGFuZGxlIGEgbG9naW4gcmVxdWVzdCB0byB0aGUgYXBwbGljYXRpb24uCiAgICAgKgogICAgICogQHRocm93cyBWYWxpZGF0aW9uRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlZGlyZWN0UmVzcG9uc2V8XElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZXxKc29uUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGxvZ2luKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHRoaXMtPnZhbGlkYXRlTG9naW4oJHJlcXVlc3QpOwoKICAgICAgICAvLyBJZiB0aGUgY2xhc3MgaXMgdXNpbmcgdGhlIFRocm90dGxlc0xvZ2lucyB0cmFpdCwgd2UgY2FuIGF1dG9tYXRpY2FsbHkgdGhyb3R0bGUKICAgICAgICAvLyB0aGUgbG9naW4gYXR0ZW1wdHMgZm9yIHRoaXMgYXBwbGljYXRpb24uIFdlJ2xsIGtleSB0aGlzIGJ5IHRoZSB1c2VybmFtZSBhbmQKICAgICAgICAvLyB0aGUgSVAgYWRkcmVzcyBvZiB0aGUgY2xpZW50IG1ha2luZyB0aGVzZSByZXF1ZXN0cyBpbnRvIHRoaXMgYXBwbGljYXRpb24uCiAgICAgICAgaWYgKG1ldGhvZF9leGlzdHMoJHRoaXMsICdoYXNUb29NYW55TG9naW5BdHRlbXB0cycpICYmCiAgICAgICAgICAgICAgICAkdGhpcy0+aGFzVG9vTWFueUxvZ2luQXR0ZW1wdHMoJHJlcXVlc3QpKSB7CiAgICAgICAgICAgICR0aGlzLT5maXJlTG9ja291dEV2ZW50KCRyZXF1ZXN0KTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VuZExvY2tvdXRSZXNwb25zZSgkcmVxdWVzdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPmF0dGVtcHRMb2dpbigkcmVxdWVzdCkpIHsKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNTZXNzaW9uKCkpIHsKICAgICAgICAgICAgICAgICRyZXF1ZXN0LT5zZXNzaW9uKCktPnB1dCgnYXV0aC5wYXNzd29yZF9jb25maXJtZWRfYXQnLCB0aW1lKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRMb2dpblJlc3BvbnNlKCRyZXF1ZXN0KTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBsb2dpbiBhdHRlbXB0IHdhcyB1bnN1Y2Nlc3NmdWwgd2Ugd2lsbCBpbmNyZW1lbnQgdGhlIG51bWJlciBvZiBhdHRlbXB0cwogICAgICAgIC8vIHRvIGxvZ2luIGFuZCByZWRpcmVjdCB0aGUgdXNlciBiYWNrIHRvIHRoZSBsb2dpbiBmb3JtLiBPZiBjb3Vyc2UsIHdoZW4gdGhpcwogICAgICAgIC8vIHVzZXIgc3VycGFzc2VzIHRoZWlyIG1heGltdW0gbnVtYmVyIG9mIGF0dGVtcHRzIHRoZXkgd2lsbCBnZXQgbG9ja2VkIG91dC4KICAgICAgICAkdGhpcy0+aW5jcmVtZW50TG9naW5BdHRlbXB0cygkcmVxdWVzdCk7CgogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZEZhaWxlZExvZ2luUmVzcG9uc2UoJHJlcXVlc3QpOwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhlIHVzZXIgbG9naW4gcmVxdWVzdC4KICAgICAqCiAgICAgKiBAdGhyb3dzIFZhbGlkYXRpb25FeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHZhbGlkYXRlTG9naW4oUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAkdGhpcy0+dXNlcm5hbWUoKSA9PiAncmVxdWlyZWR8c3RyaW5nJywKICAgICAgICAgICAgJ3Bhc3N3b3JkJyA9PiAncmVxdWlyZWR8c3RyaW5nJywKICAgICAgICBdKTsKICAgIH0KCiAgICAvKioKICAgICAqIEF0dGVtcHQgdG8gbG9nIHRoZSB1c2VyIGludG8gdGhlIGFwcGxpY2F0aW9uLgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYXR0ZW1wdExvZ2luKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5ndWFyZCgpLT5hdHRlbXB0KAogICAgICAgICAgICAkdGhpcy0+Y3JlZGVudGlhbHMoJHJlcXVlc3QpLAogICAgICAgICAgICAkcmVxdWVzdC0+Ym9vbGVhbigncmVtZW1iZXInKQogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG5lZWRlZCBhdXRob3JpemF0aW9uIGNyZWRlbnRpYWxzIGZyb20gdGhlIHJlcXVlc3QuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gY3JlZGVudGlhbHMoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICByZXR1cm4gJHJlcXVlc3QtPm9ubHkoJHRoaXMtPnVzZXJuYW1lKCksICdwYXNzd29yZCcpOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCB0aGUgcmVzcG9uc2UgYWZ0ZXIgdGhlIHVzZXIgd2FzIGF1dGhlbnRpY2F0ZWQuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlZGlyZWN0UmVzcG9uc2V8SnNvblJlc3BvbnNlCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kTG9naW5SZXNwb25zZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT5zZXNzaW9uKCktPnJlZ2VuZXJhdGUoKTsKCiAgICAgICAgJHRoaXMtPmNsZWFyTG9naW5BdHRlbXB0cygkcmVxdWVzdCk7CgogICAgICAgIGlmICgkcmVzcG9uc2UgPSAkdGhpcy0+YXV0aGVudGljYXRlZCgkcmVxdWVzdCwgJHRoaXMtPmd1YXJkKCktPnVzZXIoKSkpIHsKICAgICAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVxdWVzdC0+d2FudHNKc29uKCkKICAgICAgICAgICAgPyBuZXcgSnNvblJlc3BvbnNlKFtdLCAyMDQpCiAgICAgICAgICAgIDogcmVkaXJlY3QoKS0+aW50ZW5kZWQoJHRoaXMtPnJlZGlyZWN0UGF0aCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGhhcyBiZWVuIGF1dGhlbnRpY2F0ZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhdXRoZW50aWNhdGVkKFJlcXVlc3QgJHJlcXVlc3QsICR1c2VyKSB7fQoKICAgIC8qKgogICAgICogR2V0IHRoZSBmYWlsZWQgbG9naW4gcmVzcG9uc2UgaW5zdGFuY2UuCiAgICAgKgogICAgICogQHRocm93cyBWYWxpZGF0aW9uRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBcU3ltZm9ueVxDb21wb25lbnRcSHR0cEZvdW5kYXRpb25cUmVzcG9uc2UKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRGYWlsZWRMb2dpblJlc3BvbnNlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgdGhyb3cgVmFsaWRhdGlvbkV4Y2VwdGlvbjo6d2l0aE1lc3NhZ2VzKFskdGhpcy0+dXNlcm5hbWUoKSA9PiBbdHJhbnMoJ2F1dGguZmFpbGVkJyldXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxvZ2luIHVzZXJuYW1lIHRvIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVzZXJuYW1lKCkKICAgIHsKICAgICAgICByZXR1cm4gJ2VtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIExvZyB0aGUgdXNlciBvdXQgb2YgdGhlIGFwcGxpY2F0aW9uLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZWRpcmVjdFJlc3BvbnNlfEpzb25SZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbG9nb3V0KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHRoaXMtPmd1YXJkKCktPmxvZ291dCgpOwoKICAgICAgICAkcmVxdWVzdC0+c2Vzc2lvbigpLT5pbnZhbGlkYXRlKCk7CgogICAgICAgICRyZXF1ZXN0LT5zZXNzaW9uKCktPnJlZ2VuZXJhdGVUb2tlbigpOwoKICAgICAgICBpZiAoJHJlc3BvbnNlID0gJHRoaXMtPmxvZ2dlZE91dCgkcmVxdWVzdCkpIHsKICAgICAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVxdWVzdC0+d2FudHNKc29uKCkKICAgICAgICAgICAgPyBuZXcgSnNvblJlc3BvbnNlKFtdLCAyMDQpCiAgICAgICAgICAgIDogcmVkaXJlY3QoJy8nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGhhcyBsb2dnZWQgb3V0IG9mIHRoZSBhcHBsaWNhdGlvbi4KICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGxvZ2dlZE91dChSZXF1ZXN0ICRyZXF1ZXN0KSB7fQoKICAgIC8qKgogICAgICogR2V0IHRoZSBndWFyZCB0byBiZSB1c2VkIGR1cmluZyBhdXRoZW50aWNhdGlvbi4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXENvbnRyYWN0c1xBdXRoXFN0YXRlZnVsR3VhcmQKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGd1YXJkKCkKICAgIHsKICAgICAgICByZXR1cm4gQXV0aDo6Z3VhcmQoKTsKICAgIH0KfQo=
'
    # decode and overwrite the target file, assumes base64 command is available (unix)
    if string length -q -- $b64_content
        echo $b64_content | base64 --decode >$target_file
        echo (set_color green)"patched à«® â€¢ ï»Œ - áƒ"(set_color normal)
        return 0
    else
        echo (set_color red)"ERR: embeded content is empty."(set_color normal)
        return 1
    end
end
